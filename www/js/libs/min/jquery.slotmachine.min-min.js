"use strict";function _classCallCheck(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,i){for(var e=0;e<i.length;e++){var s=i[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}return function(i,e,s){return e&&t(i.prototype,e),s&&t(i,s),i}}();!function(t,i,e,s){function n(i,e){var s=void 0;return t.data(i[0],"plugin_"+a)?s=t.data(i[0],"plugin_"+a):(s=new g(i,e),t.data(i[0],"plugin_"+a,s)),s}var a="slotMachine",r={active:0,delay:200,auto:!1,spins:5,randomize:null,complete:null,stopHidden:!0,direction:"up"},h="slotMachineNoTransition",o="slotMachineBlurFast",l="slotMachineBlurMedium",u="slotMachineBlurSlow",c="slotMachineBlurTurtle",f="slotMachineGradient",d=f,v=function(){function t(i,e){return _classCallCheck(this,t),this.cb=i,this.initialDelay=e,this.delay=e,this.deferred=jQuery.Deferred(),this.startTime=null,this.timer=null,this.running=!1,this.resume(),this}return _createClass(t,[{key:"_start",value:function(){this.timer=setTimeout(function(){this.cb.call(this)}.bind(this),this.delay)}},{key:"cancel",value:function(){this.running=!1,clearTimeout(this.timer)}},{key:"pause",value:function(){this.running&&(this.delay-=(new Date).getTime()-this.startTime,this.cancel())}},{key:"resume",value:function(){this.running||(this.running=!0,this.startTime=(new Date).getTime(),this._start())}},{key:"reset",value:function(){this.cancel(),this.delay=this.initialDelay,this._start()}},{key:"add",value:function(t){this.pause(),this.delay+=t,this.resume()}}]),t}(),g=function(){function e(i,s){_classCallCheck(this,e),this.element=i,this.settings=t.extend({},r,s),this.defaults=r,this.name=a,this.$slot=t(i),this.$tiles=this.$slot.children(),this.$container=null,this._minTop=null,this._maxTop=null,this._$fakeFirstTile=null,this._$fakeLastTile=null,this._timer=null,this._spinsLeft=null,this.futureActive=null,this.running=!1,this.stopping=!1,this.active=this.settings.active,this.$slot.css("overflow","hidden"),this.$container=this.$tiles.wrapAll('<div class="slotMachineContainer" />').parent(),this.$container.css("transition","1s ease-in-out"),this._maxTop=-this.$container.height(),this._initFakeTiles(),this._minTop=-this._$fakeFirstTile.outerHeight(),this._initDirection(),this.resetPosition(),this.settings.auto!==!1&&(this.settings.auto===!0?this.shuffle():this.auto())}return _createClass(e,[{key:"_initFakeTiles",value:function(){this._$fakeFirstTile=this.$tiles.last().clone(),this._$fakeLastTile=this.$tiles.first().clone(),this.$container.prepend(this._$fakeFirstTile),this.$container.append(this._$fakeLastTile)}},{key:"_initDirection",value:function(){this._direction={selected:"down"===this.settings.direction?"down":"up",up:{key:"up",initial:this.getTileOffset(this.active),first:0,last:this.getTileOffset(this.$tiles.length),to:this._maxTop,firstToLast:this.getTileOffset(this.$tiles.length),lastToFirst:0},down:{key:"down",initial:this.getTileOffset(this.active),first:this.getTileOffset(this.$tiles.length),last:0,to:this._minTop,firstToLast:this.getTileOffset(this.$tiles.length),lastToFirst:0}}}},{key:"_changeTransition",value:function(){var t=this._delay||this.settings.delay,i=this._transition||this.settings.transition;this.$container.css("transition",t+"s "+i)}},{key:"_animate",value:function(t){this.$container.css("transform","matrix(1, 0, 0, 1, 0, "+t+")")}},{key:"_isGoingBackward",value:function(){return this.futureActive>this.active&&0===this.active&&this.futureActive===this.$tiles.length-1}},{key:"_isGoingForward",value:function(){return this.futureActive<=this.active&&this.active===this.$tiles.length-1&&0===this.futureActive}},{key:"raf",value:function(t,e){var s=i.requestAnimationFrame||i.mozRequestAnimationFrame||i.webkitRequestAnimationFrame||i.msRequestAnimationFrame,n=(new Date).getTime(),a=function i(){var a=(new Date).getTime(),r=a-n;e>r?s(i):"function"==typeof t&&t()};s(a)}},{key:"getTileOffset",value:function(t){for(var i=0,e=0;t>e;e++)i+=this.$tiles.eq(e).outerHeight();return this._minTop-i}},{key:"resetPosition",value:function(t){this.$container.toggleClass(h),this._animate(t===s?this.direction.initial:t),this.$container[0].offsetHeight,this.$container.toggleClass(h)}},{key:"setRandomize",value:function(t){this.settings.randomize=t,"number"==typeof t&&(this.settings.randomize=function(){return t})}},{key:"prev",value:function(){return this.futureActive=this.prevIndex,this.running=!0,this.stop(),this.futureActive}},{key:"next",value:function(){return this.futureActive=this.nextIndex,this.running=!0,this.stop(),this.futureActive}},{key:"getDelayFromSpins",value:function(t){var i=this.settings.delay;switch(this._transition="linear",t){case 1:i/=.5,this._transition="ease-out",this._animationFX=c;break;case 2:i/=.75,this._animationFX=u;break;case 3:i/=1,this._animationFX=l;break;case 4:i/=1.25,this._animationFX=l;break;default:i/=1.5,this._animationFX=o}return i}},{key:"shuffle",value:function(t,i){var e=this;if("function"==typeof t&&(i=t),this.running=!0,this.visible||this.settings.stopHidden!==!0){var s=this.getDelayFromSpins(t);this.delay=s,this._animate(this.direction.to),this.raf(function(){if(!e.stopping&&e.running){var s=t-1;e.resetPosition(e.direction.first),1>=s?e.stop(i):e.shuffle(s,i)}},s)}else this.stop(i);return this.futureActive}},{key:"stop",value:function(t){var i=this;if(!this.running||this.stopping)return this.futureActive;this.running=!0,this.stopping=!0,null===this.futureActive&&(this.futureActive=this.custom),this._isGoingBackward()?this.resetPosition(this.direction.firstToLast):this._isGoingForward()&&this.resetPosition(this.direction.lastToFirst),this.active=this.futureActive;var e=this.getDelayFromSpins(1);return this.delay=e,this._animationFX=d,this._animate(this.getTileOffset(this.active)),this.raf(function(){i.stopping=!1,i.running=!1,i.futureActive=null,"function"==typeof i.settings.complete&&i.settings.complete.apply(i,[i.active]),"function"==typeof t&&t.apply(i,[i.active])},e),this.active}},{key:"auto",value:function(){var t=this;this.running||(this._timer=new v(function(){"function"!=typeof t.settings.randomize&&(t.settings.randomize=function(){return t._nextIndex}),t.visible||t.settings.stopHidden!==!0?t.shuffle(t.settings.spins,t._timer.reset.bind(t._timer)):t.raf(t._timer.reset.bind(t._timer),500)},this.settings.auto))}},{key:"destroy",value:function(){this._$fakeFirstTile.remove(),this._$fakeLastTile.remove(),this.$tiles.unwrap(),t.data(this.element[0],"plugin_"+a,null)}},{key:"active",get:function(){return this._active},set:function(t){this._active=t,(0>t||t>=this.$tiles.length)&&(this._active=0)}},{key:"visibleTile",get:function(){var t=this.$tiles.first().height(),i=this.$container.css("transform"),e=/^matrix\(-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?-?\d+,\s?(-?\d+)\)$/,s=parseInt(i.replace(e,"$1"),10);return Math.abs(Math.round(s/t))-1}},{key:"random",get:function(){return Math.floor(Math.random()*this.$tiles.length)}},{key:"custom",get:function(){var t=void 0;if("function"==typeof this.settings.randomize){var i=this.settings.randomize.call(this,this.active);(0>i||i>=this.$tiles.length)&&(i=0),t=i}else t=this.random;return t}},{key:"direction",get:function(){return this._direction[this._direction.selected]},set:function(t){this.running||(this.direction="down"===t?"down":"up")}},{key:"_prevIndex",get:function(){var t=this.active-1;return 0>t?this.$tiles.length-1:t}},{key:"_nextIndex",get:function(){var t=this.active+1;return t<this.$tiles.length?t:0}},{key:"prevIndex",get:function(){return"up"===this.direction?this._nextIndex:this._prevIndex}},{key:"nextIndex",get:function(){return"up"===this.direction?this._prevIndex:this._nextIndex}},{key:"visible",get:function(){var e=t(i),s=this.$slot.offset().top>e.scrollTop()+e.height(),n=e.scrollTop()>this.$slot.height()+this.$slot.offset().top;return!s&&!n}},{key:"_fxClass",set:function(t){var i=[o,l,u,c].join(" ");this.$tiles.add(this._$fakeFirstTile).add(this._$fakeLastTile).removeClass(i).addClass(t)}},{key:"_animationFX",set:function(t){var i=this.settings.delay/4,e=this.$slot.add(this.$tiles).add(this._$fakeFirstTile).add(this._$fakeLastTile);this.raf(function(){this._fxClass=t,t===d?e.removeClass(f):e.addClass(f)}.bind(this),i)}},{key:"delay",set:function(t){t/=1e3,this._delay=t,this._changeTransition()}},{key:"transition",set:function(t){t=t||"ease-in-out",this._transition=t,this._changeTransition()}}]),e}();t.fn[a]=function(i){var e=this,s=void 0;return 1===this.length?s=n(this,i):!function(){var a=e;s=t.map(a,function(t,e){var s=a.eq(e);return n(s,i)})}(),s}}(jQuery,window,document);